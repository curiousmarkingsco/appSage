<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <script src="https://cdn.tailwindcss.com"></script>
      <link rel="stylesheet" href="./css/main.css">
      <link rel="stylesheet" href="./css/basic.css">
      <title>pageSage App Designer</title>
  </head>
  <body class="flex">
      <div id="sidebar" class="w-1/4 bg-gray-200 h-screen overflow-auto p-4">
        <div>
          <div class="sm:hidden">
            <label for="tabs" class="sr-only">Select a tab</label>
            <!-- Use an "onChange" listener to update sidebar to the selected tab URL. -->
            <select id="tabs" name="tabs" class="block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-base focus:border-blue-500 focus:outline-none focus:ring-blue-500 sm:text-sm">
              <option>Edit Grid</option>
              <option>Edit Column</option>
              <option selected>Edit Content</option>
            </select>
          </div>
          <div class="hidden sm:block">
            <div class="border-b border-gray-200">
              <nav class="-mb-px flex space-x-4" aria-label="Tabs">
                <!-- Current: "border-blue-500 text-blue-600", Default: "border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700" -->
                <a href="#" class="whitespace-nowrap border-b-2 border-transparent px-1 py-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700">Edit Grid</a>
                <a href="#" class="whitespace-nowrap border-b-2 border-transparent px-1 py-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700">Edit Column</a>
                <a href="#" class="whitespace-nowrap border-b-2 border-blue-500 px-1 py-4 text-sm font-medium text-blue-600" aria-current="page">Edit Content</a>
              </nav>
            </div>
          </div>
        </div>        
        <button id="addGrid" class="pagebuilder-only mt-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
          + Add Grid
        </button>
        <!-- Sidebar content for editing elements will be dynamically added here -->
         <div id="sidebar-dynamic" class="mt-4"></div>
      </div>

      <div id="page" class="w-3/4 border-l border-gray-300 p-4">
          <!-- The user's page content goes here -->
      </div>

      <script src="./js/grid.js"></script>
      <script src="./js/column.js"></script>
      <script src="./js/content.js"></script>
      <script src="./js/listener.js"></script>
      <script src="./js/sidebar.js"></script>
      <script src="./js/main.js"></script>
      <script src="./js/load.js"></script>
      <script>
        document.addEventListener('DOMContentLoaded', function() {
          const params = new URLSearchParams(window.location.search);
          const config = params.get('config');
          if (config) {
            const json = localStorage.getItem(config);  // Assuming it's stored in localStorage
            if (json) {
                loadChanges(json);
            }
            setupAutoSave(config);
          } else {
            let pageId = createNewConfigurationFile();
            setupAutoSave(pageId);
          }
        });
        
        function createNewConfigurationFile() {
          let filename = 'Untitled';
          let counter = 1;
          while (localStorage.getItem(filename)) {
              filename = `Untitled-${counter}`;
              counter++;
          }
          localStorage.setItem(filename, '[]'); // Initialize with an empty array
          window.location.search = `?config=${filename}`; // Redirect with the new file as a parameter
          return filename;
        }
      </script>
  </body>
</html>
